<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Report App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK (Module, latest version) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js';

        // Total-Water Firebase Config
        const totalWaterConfig = {
            apiKey: "AIzaSyCmHdqB4dGNAjtZUs5MjXASdzic3IJ5k5w",
            authDomain: "total-water-cc20d.firebaseapp.com",
            databaseURL: "https://total-water-cc20d-default-rtdb.firebaseio.com",
            projectId: "total-water-cc20d",
            storageBucket: "total-water-cc20d.firebasestorage.app",
            messagingSenderId: "1099058814545",
            appId: "1:1099058814545:web:70881f25d15de3f14ce270",
            measurementId: "G-3NC2PQ3F16"
        };
        const totalWaterApp = initializeApp(totalWaterConfig, "totalWater");
        const totalWaterAuth = getAuth(totalWaterApp);
        window.totalWaterDb = getFirestore(totalWaterApp);
        signInAnonymously(totalWaterAuth)
            .then(() => console.log('Total-Water: Anonymous auth successful'))
            .catch(err => console.error('Total-Water: Auth error:', err));

        // JalGanana Firebase Config
        const jalGananaConfig = {
            apiKey: "AIzaSyDSqffmlg33rpMc6a2JUddg9pYQFvR8aXU",
            authDomain: "labcalc-cee5c.firebaseapp.com",
            databaseURL: "https://labcalc-cee5c-default-rtdb.firebaseio.com",
            projectId: "labcalc-cee5c",
            storageBucket: "labcalc-cee5c.firebasestorage.app",
            messagingSenderId: "1030109019271",
            appId: "1:1030109019271:web:e66f263a8a1c003b41cc22",
            measurementId: "G-R9KDMPJX3S"
        };
        const jalGananaApp = initializeApp(jalGananaConfig, "jalGanana");
        const jalGananaAuth = getAuth(jalGananaApp);
        window.jalGananaDb = getFirestore(jalGananaApp);
        signInAnonymously(jalGananaAuth)
            .then(() => console.log('JalGanana: Anonymous auth successful'))
            .catch(err => console.error('JalGanana: Auth error:', err));
    </script>
    <!-- docx.js और FileSaver.js -->
    <script src="https://unpkg.com/docx@9.5.1/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        .status-var { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background-color: #f8f9fa; border-radius: 5px; }
        .sample-entry { margin-bottom: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input[readonly] { background-color: #f0f0f0; }
        .delete-btn { float: right; }
        .chemical-input, .chemical-final { width: 80px; display: inline-block; }
        .chemical-status { font-weight: bold; min-width: 100px; display: inline-block; vertical-align: middle; }
        .table-responsive { max-height: 400px; overflow-y: auto; }
        .alert { margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1><i class="bi bi-droplet-half"></i> Water Quality Report App</h1>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation"><a class="nav-link active" id="chi-tab" data-bs-toggle="tab" href="#chi" role="tab">CHI Details</a></li>
            <li class="nav-item" role="presentation"><a class="nav-link" id="sample-tab" data-bs-toggle="tab" href="#sample" role="tab">Sample Details</a></li>
            <li class="nav-item" role="presentation"><a class="nav-link" id="chemical-tab" data-bs-toggle="tab" href="#chemical" role="tab">Chemical Results</a></li>
            <li class="nav-item" role="presentation"><a class="nav-link" id="query-tab" data-bs-toggle="tab" href="#query" role="tab">Query Database</a></li>
            <li class="nav-item" role="presentation"><a class="nav-link" id="preview-tab" data-bs-toggle="tab" href="#preview" role="tab">Report Preview</a></li>
        </ul>
        <div class="tab-content mt-3" id="myTabContent">
            <div class="tab-pane fade show active" id="chi" role="tabpanel">
                <h4>CHI Details</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">CHI Letter No.:</label>
                            <input type="text" class="form-control" id="chi-letter-no" placeholder="e.g., MD/CHI/रासायनिक/water/01/25" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">CHI Address:</label>
                            <input type="text" class="form-control" id="chi-address" placeholder="e.g., Ajmer Station" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Division:</label>
                            <select class="form-select" id="chi-division" required>
                                <option value="">Select from list</option>
                                <option value="अजमेर">अजमेर</option>
                                <option value="जोधपुर">जोधपुर</option>
                                <option value="जयपुर">जयपुर</option>
                                <option value="बीकानेर">बीकानेर</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Report Date (DD-MM-YYYY):</label>
                            <input type="text" class="form-control" id="report-date" value="09-09-2025" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Upload CSV (optional):</label>
                            <input type="file" class="form-control" id="chi-csv" accept=".csv">
                            <button type="button" class="btn btn-primary mt-2" id="load-chi-csv">Load CSV</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-success" id="next-to-samples">Next to Samples</button>
                <button type="button" class="btn btn-secondary" id="clear-chi">Clear Form</button>
            </div>
            <div class="tab-pane fade" id="sample" role="tabpanel">
                <h4>Sample Information</h4>
                <div class="row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Number of Samples:</label>
                        <input type="number" class="form-control" id="num-samples" min="1" placeholder="e.g., 10">
                        <button type="button" class="btn btn-primary mt-2 w-100" id="add-samples-btn">Add Samples</button>
                    </div>
                    <div class="col-md-9">
                        <label class="form-label">Upload CSV (optional):</label>
                        <input type="file" class="form-control" id="sample-csv" accept=".csv">
                        <button type="button" class="btn btn-primary mt-2" id="load-sample-csv">Load CSV</button>
                    </div>
                </div>
                <button type="button" class="btn btn-success" id="next-chemical">Next to Chemical Results</button>
                <button type="button" class="btn btn-secondary" id="clear-samples">Clear Samples</button>
                <div id="sample-entries"></div>
            </div>
            <div class="tab-pane fade" id="chemical" role="tabpanel">
                <h4>Chemical Test Results</h4>
                <div id="chemical-table-container" class="table-responsive"></div>
                <div class="mt-3">
                    <button type="button" class="btn btn-success" id="submit-chemical">Submit Results</button>
                    <button type="button" class="btn btn-secondary" id="clear-chemical">Clear Results</button>
                </div>
            </div>
            <div class="tab-pane fade" id="query" role="tabpanel">
                <h4>Database Query</h4>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Lab No.:</label>
                        <input type="text" class="form-control" id="query-lab-no" placeholder="e.g., 123/2025">
                        <button type="button" class="btn btn-primary mt-2 w-100" id="fetch-lab-no">Fetch by Lab No.</button>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Sent By:</label>
                        <input type="text" class="form-control" id="query-sent-by" placeholder="Enter Sent By">
                        <button type="button" class="btn btn-primary mt-2 w-100" id="fetch-sent-by">Fetch by Sent By</button>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Location:</label>
                        <input type="text" class="form-control" id="query-location" placeholder="Enter Location">
                        <button type="button" class="btn btn-primary mt-2 w-100" id="fetch-sent-location">Fetch by Sent By + Location</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-sm" id="query-table">
                        <thead>
                            <tr>
                                <th>Lab No.</th><th>Source</th><th>Location</th><th>CHI Sample No.</th><th>Date</th><th>Sender</th>
                                <th>Colour</th><th>Odour</th><th>Turbidity</th><th>TDS</th><th>pH</th><th>T. Hardness</th>
                                <th>Calcium</th><th>Magnesium</th><th>Chloride</th><th>Alkalinity</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <button type="button" class="btn btn-primary mt-2" id="export-query-pdf">Export to PDF</button>
            </div>
            <div class="tab-pane fade" id="preview" role="tabpanel">
                <h4>Report Preview</h4>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <h5>Sample Particulars</h5>
                        <div class="table-responsive"><table class="table table-bordered table-sm" id="sample-preview-table"><thead><tr><th>क्र.सं.</th><th>विवरण</th></tr></thead><tbody></tbody></table></div>
                    </div>
                    <div class="col-md-12">
                        <h5>Chemical Analysis</h5>
                        <div class="table-responsive"><table class="table table-bordered table-sm" id="chemical-preview-table"><thead><tr><th>क.सं.</th><th>परीक्षण (Tests)</th><th>निर्धारित मान (Max)</th><th>निर्धारित मान (Desirable)</th></tr></thead><tbody></tbody></table></div>
                    </div>
                </div>
                <button type="button" class="btn btn-success" id="generate-final-report">Generate Final Report (DOCX)</button>
                <button type="button" class="btn btn-secondary" id="back-to-chemical">Back to Results</button>
            </div>
        </div>
        <div id="status-var" class="status-var"></div>
    </div>
    <script src="js/script.js" type="module"></script>
</body>
</html>
